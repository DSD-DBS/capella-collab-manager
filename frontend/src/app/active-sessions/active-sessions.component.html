<!--
 ~ SPDX-FileCopyrightText: Copyright DB Netz AG and the capella-collab-manager contributors
 ~ SPDX-License-Identifier: Apache-2.0
 -->

<div class="wrapper">
  <span id="title"><b>Active Sessions</b></span>
  <button mat-icon-button (click)="refreshSessions()">
    <mat-icon>refresh </mat-icon>
  </button>

  <mat-spinner *ngIf="showSpinner"></mat-spinner>

  <mat-card *ngIf="!ownSessionService.sessions.length && !showSpinner">
    <h2>No active sessions</h2>
    <div class="content">
      No active sessions for your user are found in our system. <br />
    </div>
  </mat-card>

  <div class="flexbox">
    <mat-card *ngFor="let session of ownSessionService.sessions; let i = index">
      <div class="header">
        <div class="type">
          <h2 *ngIf="session.type == 'persistent'">
            Persistent workspace session
          </h2>
          <h2 *ngIf="session.type == 'readonly'">
            {{ session.repository }} (read-only session)
          </h2>
        </div>
        <div
          class="state"
          [ngClass]="sessionService.beatifyState(session.state).css"
        >
          <h3>{{ sessionService.beatifyState(session.state).text }}</h3>
        </div>
      </div>
      <div class="content">
        <div class="text">
          The session was created
          {{ beautifyService.beatifyDate(session.created_at) }}
          <br />
        </div>

        <mat-card *ngIf="session.download_in_progress">
          <mat-card-content>
            <p>Your download is being preparedâ€¦</p>
            <mat-progress-bar mode="indeterminate"></mat-progress-bar>
          </mat-card-content>
        </mat-card>

        <button
          mat-flat-button
          color="primary"
          (click)="openDeletionDialog([session])"
        >
          Terminate
        </button>

        <button
          mat-flat-button
          color="primary"
          (click)="openReconnectDialog(session)"
          [disabled]="
            !(session.state === 'Started' || session.state === 'START_SESSION')
          "
        >
          Reconnect
        </button>

        <button
          mat-flat-button
          color="primary"
          (click)="uploadFileDialog(session)"
          [disabled]="
            !(session.state === 'Started' || session.state === 'START_SESSION')
          "
        >
          File browser
        </button>
      </div>
    </mat-card>
  </div>
</div>
