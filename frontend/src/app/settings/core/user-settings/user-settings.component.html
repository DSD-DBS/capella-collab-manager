<!--
 ~ SPDX-FileCopyrightText: Copyright DB InfraGO AG and contributors
 ~ SPDX-License-Identifier: Apache-2.0
 -->

<div class="flex flex-wrap gap-5">
  <div class="collab-card mb-[10px]" id="manage-users">
    <h2 class="text-xl font-medium">Manage Users</h2>

    <mat-form-field class="mt-[5px]" id="search" appearance="outline">
      <mat-label>Search</mat-label>
      <input
        [(ngModel)]="search"
        autocomplete="off"
        matInput
        placeholder="Username"
      />
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

    <mat-selection-list
      #userSelectionList
      [multiple]="false"
      [class]="
        'scrollable simple-scroll' // eslint-disable-line tailwindcss/no-custom-classname
      "
    >
      <div mat-subheader>Administrators</div>
      <div
        *ngFor="let user of getUsersByRole('administrator')"
        class="mx-1.5 my-2.5 flex justify-between"
      >
        <a [routerLink]="['/user', user.id]" class="flex items-center">
          <mat-icon mat-list-icon class="text-center">account_circle</mat-icon>
          <div class="ml-2">
            <div mat-line>{{ user.name }}</div>
            <div mat-line class="text-gray-500">
              {{ projectUserService.ADVANCED_ROLES[user.role] }}
            </div>
          </div>
        </a>
      </div>

      <div mat-subheader>Users</div>
      <div
        *ngFor="let user of getUsersByRole('user')"
        class="mx-1.5 my-2.5 flex justify-between"
      >
        <a [routerLink]="['/user', user.id]" class="flex items-center">
          <mat-icon mat-list-icon>account_circle</mat-icon>
          <div class="ml-5">
            <div mat-line>{{ user.name }}</div>
            <div mat-line class="text-gray-500">
              {{ projectUserService.ADVANCED_ROLES[user.role] }}
            </div>
          </div>
        </a>
        <div class="ml-1 mr-0 flex items-center">
          <button
            class="!mx-0 !h-[40px] !w-[40px] !px-0"
            mat-icon-button
            color="error"
            *ngIf="['user'].includes(user.role)"
            (click)="deleteUser(user)"
            matTooltip="Permamently delete user"
          >
            <mat-icon color="warn">delete</mat-icon>
          </button>

          <button
            class="!mx-0 !h-[40px] !w-[40px] !px-0"
            mat-icon-button
            color="primary"
            (click)="upgradeToAdministrator(user)"
            matTooltip="Upgrade user to administrator"
          >
            <mat-icon>arrow_upward</mat-icon>
          </button>
        </div>
      </div>

      <div *ngIf="selectedUser">
        <button
          class="!mx-0 !h-[40px] !w-[40px] !px-0"
          mat-flat-button
          color="primary"
          *ngIf="
            selectedUser.role === 'administrator' &&
            selectedUser.id !== userService.user?.id
          "
          (click)="downgradeToUser(selectedUser)"
        >
          <mat-icon>arrow_downward</mat-icon>
          Downgrade {{ selectedUser.name }} to User
        </button>
        <button
          class="!mx-0 !h-[40px] !w-[40px] !px-0"
          mat-flat-button
          color="primary"
          (click)="upgradeToAdministrator(selectedUser)"
          *ngIf="selectedUser.role === 'user'"
        >
          <mat-icon>arrow_upward</mat-icon>
          Upgrade
          {{ selectedUser.name }} to Administrator
        </button>
        <button
          class="!mx-0 !h-[40px] !w-[40px] !px-0"
          mat-flat-button
          color="primary"
          (click)="deleteUser(selectedUser)"
          *ngIf="selectedUser.role === 'user'"
        >
          <mat-icon color="warn">delete</mat-icon>
          Delete {{ selectedUser.name }}
        </button>
      </div>
    </mat-selection-list>
  </div>
  <div class="default collab-card h-1/4">
    <h2 class="text-xl font-medium">Create User</h2>
    In general, users are created automatically when logging in the first time.
    <br />
    However, there may be cases where you want to create the user before the
    first login. <br />
    <form [formGroup]="createUserFormGroup" class="flex justify-between">
      <mat-form-field>
        <mat-label>Username</mat-label>
        <input matInput formControlName="username" />
        <mat-error *ngIf="username.getError('required')"
          >Please enter a username!</mat-error
        >
        <mat-error *ngIf="username.getError('userAlreadyExists')"
          >The username does already exist!</mat-error
        >
      </mat-form-field>
      <button
        mat-flat-button
        (click)="createUser()"
        color="primary"
        class="!h-[50px] !text-lg"
      >
        Create User
        <mat-icon class="text-lg" iconPositionEnd
          >keyboard_arrow_right</mat-icon
        >
      </button>
    </form>
  </div>
</div>
