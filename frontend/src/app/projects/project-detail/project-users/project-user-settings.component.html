<!--
 ~ SPDX-FileCopyrightText: Copyright DB Netz AG and the capella-collab-manager contributors
 ~ SPDX-License-Identifier: Apache-2.0
 -->

<div>
  <div id="manage-users-header">
    <div class="flexbox flex-space-between">
      <h2>Project members</h2>
      <div class="flexbox">
        <button
          id="add-user"
          (click)="openAddUserDialog()"
          mat-stroked-button
          matTooltip="Add a new user"
        >
          <mat-icon>add</mat-icon>
        </button>
      </div>
    </div>
  </div>
  <mat-card id="manage-users">
    <div id="search-wrapper">
      <mat-form-field id="search" appearance="outline">
        <mat-label>Search</mat-label>
        <input
          [(ngModel)]="search"
          autocomplete="off"
          matInput
          placeholder="Username"
        />
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </div>
    <div class="scrollable">
      <div *ngFor="let role of ['manager', 'user', 'administrator']">
        <div class="roleTitle">{{ capitalizeFirstLetter(role) }}</div>
        <div
          class="user"
          *ngFor="
            let user of getProjectUsersByRole(
              projectUserService.projectUsers | async,
              role
            )
          "
        >
          <div class="flexbox">
            <mat-icon class="accountCircle" mat-list-icon
              >account_circle</mat-icon
            >
            <div>
              <div class="username">{{ user.user.name }}</div>
              <div class="userrole">
                {{ projectUserService.ADVANCED_ROLES[user.role] }},
                {{ projectUserService.PERMISSIONS[user.permission] }}
              </div>
            </div>
          </div>
          <div class="flexbox useractions">
            <button
              mat-icon-button
              color="error"
              *ngIf="['user', 'manager'].includes(user.role)"
              (click)="removeUserFromProject(user.user)"
              matTooltip="Remove user from project"
            >
              <mat-icon>delete</mat-icon>
            </button>

            <button
              mat-icon-button
              color="primary"
              *ngIf="'user' === user.role"
              (click)="upgradeUserToProjectManager(user.user)"
              matTooltip="Upgrade user to project manager"
            >
              <mat-icon>arrow_upward</mat-icon>
            </button>
            <button
              mat-icon-button
              color="primary"
              *ngIf="'manager' === user.role"
              (click)="downgradeUserToUserRole(user.user)"
              matTooltip="Downgrade user to simple user"
            >
              <mat-icon>arrow_downward</mat-icon>
            </button>
            <div *ngIf="'manager' !== user.role">
              <button
                mat-icon-button
                color="primary"
                *ngIf="'read' === user.permission"
                (click)="setUserPermission(user.user, 'write')"
                matTooltip="Set permission of user to read/write"
              >
                <mat-icon>folder_shared</mat-icon>
              </button>
              <button
                mat-icon-button
                color="primary"
                *ngIf="
                  'write' === user.permission && user.role !== 'administrator'
                "
                (click)="setUserPermission(user.user, 'read')"
                matTooltip="Set permission of user to read only"
              >
                <mat-icon>folder_open</mat-icon>
              </button>
            </div>
          </div>
        </div>
        <div *ngIf="(projectUserService.projectUsers | async) === undefined">
          <ngx-skeleton-loader
            appearance="circle"
            [theme]="{
              'border-radius': '5px',
              height: '125px',
              width: '375px',
              border: '1px solid white'
            }"
          ></ngx-skeleton-loader>
        </div>
      </div>
    </div>
  </mat-card>
</div>
