<!--
 ~ SPDX-FileCopyrightText: Copyright DB Netz AG and the capella-collab-manager contributors
 ~ SPDX-License-Identifier: Apache-2.0
 -->

<div *ngIf="!selectedSessions.length">
  <span
    >Please select the sessions that you'd like to open in the session
    viewer:</span
  >
  <div *ngIf="cachedSessions && !cachedSessions.length">
    No sessions found. Please create a session in the 'Sessions' tab first.
  </div>

  <div *ngIf="cachedSessions === undefined">
    <ngx-skeleton-loader
      *ngFor="let _ of [0, 1, 2, 3]"
      appearance="circle"
      [theme]="{
        'border-radius': '5px',
        height: '24px',
        width: '80%',
        border: '1px solid white',
        margin: '0'
      }"
    ></ngx-skeleton-loader>
  </div>

  <div class="flex flex-col" *ngIf="cachedSessions && cachedSessions.length">
    <mat-checkbox
      class="w-fit"
      [disabled]="!sessionService.beautifyState(session.state).success"
      matTooltip="Please wait until the session is running. You can check the status in the 'Sessions' tab."
      [matTooltipDisabled]="sessionService.beautifyState(session.state).success"
      [value]="session.id"
      (change)="changeSessionSelection($event, session)"
      *ngFor="let session of cachedSessions"
      >{{ session.version?.tool?.name }} {{ session.version?.name }},
      {{ session.type
      }}<span *ngIf="session.type === 'readonly'">
        (project {{ session.project!.name }})</span
      >, created at {{ session.created_at | date: "EE, dd MMM y HH:mm:ss" }}
    </mat-checkbox>
  </div>

  <div class="mt-2 w-fit rounded border-2 p-2">
    Please note: We're not technically preventing that you select two
    Eclipse-based sessions (for example two Capella sessions), <br />but the
    server will not let you connect to the sessions. We're working on making
    this possible.
  </div>
  <div class="mt-2">
    <mat-radio-group [(ngModel)]="selectedWindowType">
      <mat-radio-button value="floating">Floating window</mat-radio-button>
      <mat-radio-button value="tailing">Tailing window</mat-radio-button>
    </mat-radio-group>
  </div>

  <div class="mt-2">
    <button
      mat-raised-button
      (click)="selectSessions()"
      [disabled]="checkedSessions === undefined || !checkedSessions.length"
      class="flex"
    >
      Open session viewer
      <mat-icon class="mat-icon-position">navigate_next</mat-icon>
    </button>
  </div>
</div>

<app-floating-window-manager
  *ngIf="selectedSessions.length"
  [sessions]="selectedSessions"
></app-floating-window-manager>

<div class="fixed bottom-4 right-4 z-50">
  <button
    mat-fab
    color="primary"
    (click)="fullscreenService.toggleFullscreen()"
  >
    <mat-icon *ngIf="(fullscreenService.isFullscreen$ | async) === false"
      >fullscreen</mat-icon
    >
    <mat-icon *ngIf="fullscreenService.isFullscreen$ | async"
      >fullscreen_exit</mat-icon
    >
  </button>
</div>
