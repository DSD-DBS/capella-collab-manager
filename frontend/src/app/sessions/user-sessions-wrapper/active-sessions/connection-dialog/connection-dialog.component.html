<!--
 ~ SPDX-FileCopyrightText: Copyright DB Netz AG and the capella-collab-manager contributors
 ~ SPDX-License-Identifier: Apache-2.0
 -->

<div
  *ngIf="
    isPersistentSession(session) && session.version?.tool?.integrations?.t4c
  "
>
  <div class="m-m-card">
    <div class="mb-1 text-base font-bold">TeamForCapella session token</div>
    If you'd like to connect to TeamForCapella while working with Capella,
    <br />
    please copy your session token and enter it when prompted in your Capella
    session.
    <br />
    You can always return to this dialog by clicking on "Connect" in the "Active
    sessions" overview. <br />
    <div *ngIf="session?.t4c_password">
      <app-display-value
        [value]="session!.t4c_password"
        [blurValue]="true"
        valueName="TeamForCapella token"
      ></app-display-value>
    </div>
    <div *ngIf="!session?.t4c_password">
      No session token was generated for your session.
    </div>
  </div>
  <hr />
</div>

<div class="m-m-card">
  <div class="mb-1 text-base font-bold">Connect to the session</div>
  Please choose if you want to connect via the browser or via a native RDP
  client to the session.
  <div class="mt-2 flex gap-2">
    <button mat-raised-button color="primary" (click)="redirectToGuacamole()">
      Connect via browser <mat-icon>open_in_new</mat-icon>
    </button>
    <button mat-raised-button color="primary" (click)="requestNativeClient()">
      Connect via native client <mat-icon>arrow_downward</mat-icon>
    </button>
  </div>
</div>
<div *ngIf="nativeClient">
  <hr />
  <div
    *ngIf="!sessionRoute?.host && !failedPublicRouteRequest"
    class="m-m-card flex items-center justify-between"
  >
    <div>
      <div class="mb-1 text-base font-bold">Wait for a public route</div>
      We have requested a public route to your session. <br />Once the route is
      available the status will be updated here. <br />This can take up to one
      minute.
    </div>
    <mat-spinner [diameter]="50"></mat-spinner>
  </div>
  <hr />
  <div
    *ngIf="failedPublicRouteRequest"
    class="m-m-card flex items-center justify-between text-error"
  >
    <div>
      <div class="mb-1 text-base font-bold">Couldn't request public route</div>
      We were unable to request a public route for your session. <br />Please
      connect via the browser to your session or try again.
    </div>
    <mat-icon class="mr-5 scale-150">sms_failed</mat-icon>
  </div>
  <hr />
  <div class="m-m-card" *ngIf="sessionRoute?.host">
    <div class="mb-1 text-base font-bold">Open the native client</div>
    When you click on this button, your browser will ask you to open the native
    client. <br />
    Please confirm the dialog. If it does not work, you can also connect
    manually with the following data:

    <app-display-value
      [value]="sessionRoute?.host"
      [blurValue]="false"
      valueName="RDP Hostname"
    ></app-display-value>
  </div>
</div>
<hr />
<div class="m-m-card">
  <div class="mb-1 text-base font-bold">
    Wait for {{ session.version?.tool?.name }}
  </div>
  After opening the session, {{ session.version?.tool?.name }}
  {{ session.version?.name }} starts automatically. This can take up to one
  minute.
</div>
